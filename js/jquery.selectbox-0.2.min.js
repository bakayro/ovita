function s(){this._state=[],this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",classFocus:"sbFocus",speed:200,effect:"slide",onChange:null,onOpen:null,onClose:null}}var g,f,a;g=jQuery,a=!(f="selectbox"),g.extend(s.prototype,{_isOpenSelectbox:function(s){return s?this._getInst(s).isOpen:a},_isDisabledSelectbox:function(s){return s?this._getInst(s).isDisabled:a},_attachSelectbox:function(l,s){if(this._getInst(l))return a;var o,c,d,e=g(l),r=this,u=r._newInst(e),p=a,t=(e.find("optgroup"),e.find("option")),b=t.length;function i(){var s,e,t=this.attr("id").split("_")[1];for(s in r._state)s!==t&&r._state.hasOwnProperty(s)&&(e=g("select[sb='"+s+"']")[0])&&r._closeSelectbox(e)}function n(s,e){var n=!(!e||!e.sub),a=!(!e||!e.disabled);s.each(function(s){var e,t=g(this),i=g("<li>");t.is(":selected")&&(o.text(t.text()),p=!0),s===b-1&&i.addClass("last"),t.is(":disabled")||a?(e=g("<span>",{text:t.text()}).addClass(u.settings.classDisabled),n&&e.addClass(u.settings.classSub)):(e=g("<a>",{href:"#"+t.val(),rel:t.val()}).text(t.text()).bind("click.sb",function(s){s&&s.preventDefault&&s.preventDefault();var e=c,s=g(this);e.attr("id").split("_")[1];r._changeSelectbox(l,s.attr("rel"),s.text()),r._closeSelectbox(l)}).bind("mouseover.sb",function(){var s=g(this);s.parent().siblings().find("a").removeClass(u.settings.classFocus),s.addClass(u.settings.classFocus)}).bind("mouseout.sb",function(){g(this).removeClass(u.settings.classFocus)}),n&&e.addClass(u.settings.classSub),t.is(":selected")&&e.addClass(u.settings.classFocus)),e.appendTo(i),i.appendTo(d)})}e.attr("sb",u.uid),g.extend(u.settings,r._defaults,s),r._state[u.uid]=a,e.hide(),s=g("<div>",{id:"sbHolder_"+u.uid,class:u.settings.classHolder,tabindex:e.attr("tabindex")}),o=g("<a>",{id:"sbSelector_"+u.uid,href:"#",class:u.settings.classSelector,click:function(s){s.preventDefault(),i.apply(g(this),[]);s=g(this).attr("id").split("_")[1];r._state[s]?r._closeSelectbox(l):r._openSelectbox(l)}}),(c=g("<a>",{id:"sbToggle_"+u.uid,href:"#",class:u.settings.classToggle,click:function(s){s.preventDefault(),i.apply(g(this),[]);s=g(this).attr("id").split("_")[1];r._state[s]?r._closeSelectbox(l):r._openSelectbox(l)}})).appendTo(s),d=g("<ul>",{id:"sbOptions_"+u.uid,class:u.settings.classOptions,css:{display:"none"}}),e.children().each(function(s){var e,t=g(this),i={};t.is("option")?n(t):t.is("optgroup")&&(e=g("<li>"),g("<span>",{text:t.attr("label")}).addClass(u.settings.classGroup).appendTo(e),e.appendTo(d),t.is(":disabled")&&(i.disabled=!0),i.sub=!0,n(t.find("option"),i))}),p||o.text(t.first().text()),g.data(l,f,u),s.data("uid",u.uid).bind("keydown.sb",function(s){var e,t=s.charCode||s.keyCode||0,i=g(this),n=i.data("uid"),a=i.siblings("select[sb='"+n+"']").data(f),l=i.siblings(["select[sb='",n,"']"].join("")).get(0),o=i.find("ul").find("a."+a.settings.classFocus);switch(t){case 37:case 38:0<o.length&&(g("a",i).removeClass(a.settings.classFocus),0<(e=o.parent().prevAll("li:has(a)").eq(0).find("a")).length&&(e.addClass(a.settings.classFocus).focus(),g("#sbSelector_"+n).text(e.text())));break;case 39:case 40:g("a",i).removeClass(a.settings.classFocus),0<(e=0<o.length?o.parent().nextAll("li:has(a)").eq(0).find("a"):i.find("ul").find("a").eq(0)).length&&(e.addClass(a.settings.classFocus).focus(),g("#sbSelector_"+n).text(e.text()));break;case 13:0<o.length&&r._changeSelectbox(l,o.attr("rel"),o.text()),r._closeSelectbox(l);break;case 9:l&&(a=r._getInst(l))&&(0<o.length&&r._changeSelectbox(l,o.attr("rel"),o.text()),r._closeSelectbox(l));i=parseInt(i.attr("tabindex"),10);s.shiftKey?i--:i++,g("*[tabindex='"+i+"']").focus();break;case 27:r._closeSelectbox(l)}return s.stopPropagation(),!1}).delegate("a","mouseover",function(s){g(this).addClass(u.settings.classFocus)}).delegate("a","mouseout",function(s){g(this).removeClass(u.settings.classFocus)}),o.appendTo(s),d.appendTo(s),s.insertAfter(e),g("html").on("mousedown",function(s){s.stopPropagation(),g("select").selectbox("close")}),g([".",u.settings.classHolder,", .",u.settings.classSelector].join("")).mousedown(function(s){s.stopPropagation()})},_detachSelectbox:function(s){var e=this._getInst(s);if(!e)return a;g("#sbHolder_"+e.uid).remove(),g.data(s,f,null),g(s).show()},_changeSelectbox:function(s,e,t){var i,n=this._getInst(s);n&&(i=this._get(n,"onChange"),g("#sbSelector_"+n.uid).text(t)),e=e.replace(/\'/g,"\\'"),g(s).find("option[value='"+e+"']").attr("selected",!0),n&&i?i.apply(n.input?n.input[0]:null,[e,n]):n&&n.input&&n.input.trigger("change")},_enableSelectbox:function(s){var e=this._getInst(s);if(!e||!e.isDisabled)return a;g("#sbHolder_"+e.uid).removeClass(e.settings.classHolderDisabled),e.isDisabled=a,g.data(s,f,e)},_disableSelectbox:function(s){var e=this._getInst(s);if(!e||e.isDisabled)return a;g("#sbHolder_"+e.uid).addClass(e.settings.classHolderDisabled),e.isDisabled=!0,g.data(s,f,e)},_optionSelectbox:function(s,e,t){var i=this._getInst(s);if(!i)return a;i[e]=t,g.data(s,f,i)},_openSelectbox:function(s){var e,t,i,n,a,l=this._getInst(s);!l||l.isOpen||l.isDisabled||(e=g("#sbOptions_"+l.uid),t=parseInt(g(window).height(),10),n=g("#sbHolder_"+l.uid).offset(),a=g(window).scrollTop(),i=e.prev().height(),n=t-(n.top-a)-i/2,a=this._get(l,"onOpen"),e.css({top:i+"px",maxHeight:n-i+"px"}),"fade"===l.settings.effect?e.fadeIn(l.settings.speed):e.slideDown(l.settings.speed),g("#sbToggle_"+l.uid).addClass(l.settings.classToggleOpen),this._state[l.uid]=!0,l.isOpen=!0,a&&a.apply(l.input?l.input[0]:null,[l]),g.data(s,f,l))},_closeSelectbox:function(s){var e,t=this._getInst(s);t&&t.isOpen&&(e=this._get(t,"onClose"),"fade"===t.settings.effect?g("#sbOptions_"+t.uid).fadeOut(t.settings.speed):g("#sbOptions_"+t.uid).slideUp(t.settings.speed),g("#sbToggle_"+t.uid).removeClass(t.settings.classToggleOpen),this._state[t.uid]=a,t.isOpen=a,e&&e.apply(t.input?t.input[0]:null,[t]),g.data(s,f,t))},_newInst:function(s){return{id:s[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),input:s,uid:Math.floor(99999999*Math.random()),isOpen:a,isDisabled:a,settings:{}}},_getInst:function(s){try{return g.data(s,f)}catch(s){throw"Missing instance data for this selectbox"}},_get:function(s,e){return(void 0!==s.settings[e]?s.settings:this._defaults)[e]}}),g.fn.selectbox=function(s){var e=Array.prototype.slice.call(arguments,1);return"string"==typeof s&&"isDisabled"==s||"option"==s&&2==arguments.length&&"string"==typeof arguments[1]?g.selectbox["_"+s+"Selectbox"].apply(g.selectbox,[this[0]].concat(e)):this.each(function(){"string"==typeof s?g.selectbox["_"+s+"Selectbox"].apply(g.selectbox,[this].concat(e)):g.selectbox._attachSelectbox(this,s)})},g.selectbox=new s,g.selectbox.version="0.2";